#!/usr/bin/env python
import sys
import argparse

from delta.config import config
from delta.subcommands import commands

def main(args):
    parser = argparse.ArgumentParser(description='DELTA Machine Learning Toolkit')
    subparsers = parser.add_subparsers()

    for d in commands.SETUP_COMMANDS:
        d(subparsers)

    try:
        options = parser.parse_args(args[1:])
    except argparse.ArgumentError:
        parser.print_help(sys.stderr)
        sys.exit(1)

    if not hasattr(options, 'function'):
        parser.print_help(sys.stderr)
        sys.exit(1)

    config.parse_args(options)
    return options.function(options)

if __name__ == "__main__":
    sys.exit(main(sys.argv))
